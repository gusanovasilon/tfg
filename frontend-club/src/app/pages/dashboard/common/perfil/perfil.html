<div class="header-perfil">
  <h2>GESTIÓN DE <span class="highlight">PERFIL</span></h2>
  <p>Panel de control de <strong>{{ usuario.nombre | uppercase }}</strong> <span class="badge-rol">{{ usuario.rol | uppercase
      }}</span></p>
</div>

@if (esDeportivo) {
<div class="player-card-container">
  <div class="player-card">

    <div class="card-visuals">
      <div class="image-frame">
        @if (previewUrl) {
        <img [src]="previewUrl" alt="Foto Atleta" class="player-photo">
        } @else {
        <div class="placeholder-hero">
          <span>{{ usuario.nombre | slice:0:1 }}</span>
        </div>
        }
      </div>
      <label class="btn-upload-hero">
        <i class="bi bi-camera-fill"></i> Cambiar Foto
        <input type="file" (change)="onFileSelected($event)" accept="image/*" hidden>
      </label>
    </div>

    <div class="card-stats">
      <div class="stats-header">
        <h3>
          {{ usuario.nombre }}
          <i class="bi bi-patch-check-fill verified-icon"></i>
        </h3>
      </div>

      <form (ngSubmit)="guardarFicha(fichaForm)" #fichaForm="ngForm">

        @if (rol === 'atleta') {
        <div class="stats-grid">
          <div class="stat-box">
            <label>PESO (KG)</label>
            <input type="number" step="0.1" name="peso" [(ngModel)]="ficha.peso" required placeholder="0.0">
          </div>
          <div class="stat-box">
            <label>ALTURA (CM)</label>
            <input type="number" name="altura" [(ngModel)]="ficha.altura" required placeholder="0">
          </div>
          <div class="stat-box full-width">
            <label>CATEGORÍA</label>
            <select name="categoria" [(ngModel)]="ficha.categoria" required>
              <option value="">Selecciona...</option>
              <option value="Escolar">Escolar</option>
              <option value="Cadete">Cadete</option>
              <option value="Junior">Junior</option>
              <option value="Senior">Senior</option>
              <option value="Veterano">Veterano</option>
            </select>
          </div>
        </div>
        }

        @if (rol === 'entrenador') {
        <div class="stats-grid">
          <div class="stat-box full-width">
            <label>ESPECIALIDAD</label>
            <input type="text" name="especialidad" [(ngModel)]="ficha.especialidad" required>
          </div>
          <div class="stat-box full-width">
            <label>BIOGRAFÍA</label>
            <textarea name="biografia" rows="4" [(ngModel)]="ficha.biografia" required minlength="10"></textarea>
          </div>
        </div>
        }

        <button type="submit" class="btn-update-card">ACTUALIZAR FICHA</button>
      </form>
    </div>
  </div>
</div>
}

<div class="account-container">
  <div class="card-simple">
    <div class="card-header-simple">
      <h3><i class="bi bi-shield-lock"></i> Seguridad y Acceso</h3>
    </div>

    <form (ngSubmit)="guardarCuenta(cuentaForm)" #cuentaForm="ngForm">

      <div class="form-row-simple">
        <div class="form-group">
          <label>Nombre</label>
          <input type="text" class="form-control" name="nombre" [(ngModel)]="datosCuenta.nombre" required minlength="2"
            #nombreVar="ngModel">
          @if (nombreVar.invalid && (nombreVar.dirty || nombreVar.touched)) {
          <small class="error-text">Nombre obligatorio</small>
          }
        </div>

        <div class="form-group">
          <label>Apellidos</label>
          <input type="text" class="form-control" name="apellidos" [(ngModel)]="datosCuenta.apellidos" required>
        </div>

        <div class="form-group">
          <label>Usuario</label>
          <input type="text" class="form-control" name="username" [(ngModel)]="datosCuenta.username" required>
        </div>

        <div class="form-group">
          <label>Email</label>
          <input type="email" class="form-control" name="email" [(ngModel)]="datosCuenta.email" required email
            #emailVar="ngModel">
          @if (emailVar.invalid && (emailVar.dirty || emailVar.touched)) {
          <small class="error-text">Email incorrecto</small>
          }
        </div>
      </div>

      <div class="password-row">
        <div style="flex:1">
          <input type="password" class="form-control" placeholder="Nueva Contraseña" name="password"
            [(ngModel)]="datosCuenta.password" pattern="^(?=.*[A-Za-z])(?=.*\d).{6,}$" #passVar="ngModel">

          @if (passVar.invalid && (passVar.dirty || passVar.touched)) {
          <div class="error-text">
            @if (passVar.errors?.['pattern']) {
            <span>Debe tener 6 caracteres, letras y números.</span>
            }
          </div>
          }
        </div>

        <div style="flex:1">
          <input type="password" class="form-control" placeholder="Confirmar" name="confirmPassword"
            [(ngModel)]="datosCuenta.confirmPassword">
        </div>
      </div>

      <button type="submit" class="btn-save-simple">Guardar Datos Privados</button>
    </form>
  </div>
</div>
