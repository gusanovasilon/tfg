ERROR - 2026-02-18 16:44:06 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(90): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 16:44:07 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(90): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:44:07 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(90): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:44:07 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(90): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 16:51:20 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 16:51:20 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:51:20 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:51:20 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 16:54:13 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
ERROR - 2026-02-18 16:54:13 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 16:54:13 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:54:13 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:54:13 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:54:13 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:54:13 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:54:13 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 16:54:44 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 16:54:44 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:54:44 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:54:44 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 16:54:49 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 16:54:49 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:54:49 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:54:49 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(95): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 16:59:42 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 16:59:42 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:42 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:42 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 16:59:44 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
ERROR - 2026-02-18 16:59:44 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 16:59:44 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:44 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:44 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:44 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:44 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:44 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 16:59:44 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 16:59:44 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:44 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:44 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 16:59:51 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 16:59:52 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:52 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:52 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 16:59:52 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
ERROR - 2026-02-18 16:59:52 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 16:59:52 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:52 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:52 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:52 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:52 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 16:59:52 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 16:59:52 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:52 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:52 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:52 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 16:59:52 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 16:59:52 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:52 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 16:59:52 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:00:48 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:00:48 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:00:48 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:00:48 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:01:04 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:01:05 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:05 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:05 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:01:40 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
ERROR - 2026-02-18 17:01:40 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:01:40 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:40 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:40 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:40 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:40 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:40 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:01:40 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:01:40 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:40 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:40 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:01:40 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:01:41 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:41 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:41 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:01:42 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:01:42 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:42 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:42 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:01:42 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:01:42 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:42 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:42 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:01:42 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
ERROR - 2026-02-18 17:01:42 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:01:42 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:42 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:42 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:42 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:42 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:42 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:01:43 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:01:43 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:43 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:43 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:01:43 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:01:43 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:43 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:43 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:01:43 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:01:43 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:43 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:43 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:01:44 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
ERROR - 2026-02-18 17:01:44 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:01:44 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:44 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:44 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:44 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:44 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:44 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:01:45 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:01:45 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:45 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:45 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:01:45 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:01:45 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:45 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:01:45 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:02:24 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:02:24 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:02:24 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:02:24 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:02:55 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:02:55 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:02:55 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:02:55 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:04:09 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:04:10 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:04:10 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:04:10 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:04:12 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:04:12 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:04:12 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:04:12 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:04:37 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:04:37 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:04:37 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:04:38 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:04:52 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:04:52 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:04:52 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:04:52 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:04:54 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:04:54 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:04:54 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:04:54 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`foto_url ELSE u1`.`foto_url END` as `foto_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(100): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:13:37 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:13:37 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:13:37 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:13:37 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:14:39 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
ERROR - 2026-02-18 17:14:39 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:14:39 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:39 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:39 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:39 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:39 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:39 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:14:39 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:14:39 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:39 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:39 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:14:40 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:14:40 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:40 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:14:40 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:14:40 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:40 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:40 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:40 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:14:41 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
ERROR - 2026-02-18 17:14:41 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:14:41 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:41 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:41 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:41 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:14:41 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:14:41 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:41 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:41 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:41 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:41 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:14:41 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:14:41 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:41 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:41 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:14:48 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1 in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id`...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id`...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id`...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id`...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
#6 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 17:14:48 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
[Method: GET, Route: api/mensajes/5]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 2 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 3 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 4 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 5 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:48 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 4 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 5 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 6 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 7 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:14:48 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`ape...' at line 1
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = 5
OR `c`.`usuario_2_id` = 5
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC')
 4 SYSTEMPATH/Database/BaseBuilder.php(1649): CodeIgniter\Database\BaseConnection->query('SELECT `c`.`id` as `conversacion_id`, `c`.`ultimo_mensaje_at`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`nombre ELSE u1`.`nombre END` as `nombre_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`apellidos ELSE u1`.`apellidos END` as `apellidos_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`rol ELSE u1`.`rol END` as `rol_otro`, `CASE WHEN c`.`usuario_1_id = 5 THEN u2`.`id ELSE u1`.`id END` as `id_otro`, (SELECT cuerpo FROM mensajes WHERE conversacion_id = c.id ORDER BY fecha_envio DESC LIMIT 1) as ultimo_mensaje
FROM (`conversaciones`, `conversaciones` `c`)
LEFT JOIN `usuarios` `u1` ON `c`.`usuario_1_id` = `u1`.`id`
LEFT JOIN `usuarios` `u2` ON `c`.`usuario_2_id` = `u2`.`id`
WHERE   (
`c`.`usuario_1_id` = :c.usuario_1_id:
OR `c`.`usuario_2_id` = :c.usuario_2_id:
 )
ORDER BY `c`.`ultimo_mensaje_at` DESC', [...], false)
 5 SYSTEMPATH/Model.php(286): CodeIgniter\Database\BaseBuilder->get()
 6 SYSTEMPATH/BaseModel.php(677): CodeIgniter\Model->doFindAll(0, 0)
 7 APPPATH/Models/ConversacionModel.php(71): CodeIgniter\BaseModel->findAll()
 8 APPPATH/Controllers/Api/Mensajes.php(44): App\Models\ConversacionModel->getMisConversaciones('5')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->index('5')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 17:59:26 --> mysqli_sql_exception: Unknown column 'created_at' in 'INSERT INTO' in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `co...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `co...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `co...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `co...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(838): CodeIgniter\Model->doInsert(Array)
#6 /var/www/html/tfg/club_lucha_api/system/Model.php(797): CodeIgniter\BaseModel->insert(Array, true)
#7 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(41): CodeIgniter\Model->insert(Array)
#8 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#11 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#13 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#14 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#15 {main}
CRITICAL - 2026-02-18 17:59:26 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'created_at' in 'INSERT INTO'
[Method: POST, Route: api/mensajes]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 2 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 3 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 4 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 5 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 6 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
 7 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
 8 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 9 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
10 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
11 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
12 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:59:26 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'created_at' in 'INSERT INTO'
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 17:59:26\', \'2026-02-18 17:59:26\')')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 17:59:26\', \'2026-02-18 17:59:26\')')
 3 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 4 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 5 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 6 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 7 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 8 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 17:59:26 --> [Caused by] mysqli_sql_exception: Unknown column 'created_at' in 'INSERT INTO'
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 17:59:26\', \'2026-02-18 17:59:26\')', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 17:59:26\', \'2026-02-18 17:59:26\')')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 17:59:26\', \'2026-02-18 17:59:26\')')
 4 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 5 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 6 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 7 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 8 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 9 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
10 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
11 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
12 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
13 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
14 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
15 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 18:08:41 --> mysqli_sql_exception: Unknown column 'created_at' in 'INSERT INTO' in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `co...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `co...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `co...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `co...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(838): CodeIgniter\Model->doInsert(Array)
#6 /var/www/html/tfg/club_lucha_api/system/Model.php(797): CodeIgniter\BaseModel->insert(Array, true)
#7 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(41): CodeIgniter\Model->insert(Array)
#8 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#11 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#13 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#14 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#15 {main}
CRITICAL - 2026-02-18 18:08:41 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'created_at' in 'INSERT INTO'
[Method: POST, Route: api/mensajes]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 2 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 3 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 4 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 5 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 6 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
 7 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
 8 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 9 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
10 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
11 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
12 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:08:41 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'created_at' in 'INSERT INTO'
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:08:41\', \'2026-02-18 18:08:41\')')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:08:41\', \'2026-02-18 18:08:41\')')
 3 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 4 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 5 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 6 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 7 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 8 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:08:41 --> [Caused by] mysqli_sql_exception: Unknown column 'created_at' in 'INSERT INTO'
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:08:41\', \'2026-02-18 18:08:41\')', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:08:41\', \'2026-02-18 18:08:41\')')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:08:41\', \'2026-02-18 18:08:41\')')
 4 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 5 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 6 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 7 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 8 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 9 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
10 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
11 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
12 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
13 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
14 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
15 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 18:10:04 --> mysqli_sql_exception: Unknown column 'created_at' in 'INSERT INTO' in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `co...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `co...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `co...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `co...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(838): CodeIgniter\Model->doInsert(Array)
#6 /var/www/html/tfg/club_lucha_api/system/Model.php(797): CodeIgniter\BaseModel->insert(Array, true)
#7 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(41): CodeIgniter\Model->insert(Array)
#8 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#11 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#13 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#14 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#15 {main}
ERROR - 2026-02-18 18:10:04 --> mysqli_sql_exception: Unknown column 'created_at' in 'INSERT INTO' in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `co...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `co...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `co...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `co...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(838): CodeIgniter\Model->doInsert(Array)
#6 /var/www/html/tfg/club_lucha_api/system/Model.php(797): CodeIgniter\BaseModel->insert(Array, true)
#7 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(41): CodeIgniter\Model->insert(Array)
#8 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#11 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#13 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#14 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#15 {main}
CRITICAL - 2026-02-18 18:10:04 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'created_at' in 'INSERT INTO'
[Method: POST, Route: api/mensajes]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 2 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 3 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 4 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 5 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 6 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
 7 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
 8 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 9 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
10 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
11 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
12 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:10:04 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'created_at' in 'INSERT INTO'
[Method: POST, Route: api/mensajes]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 2 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 3 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 4 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 5 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 6 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
 7 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
 8 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 9 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
10 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
11 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
12 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:10:04 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'created_at' in 'INSERT INTO'
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:04\', \'2026-02-18 18:10:04\')')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:04\', \'2026-02-18 18:10:04\')')
 3 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 4 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 5 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 6 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 7 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 8 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:10:04 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'created_at' in 'INSERT INTO'
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:04\', \'2026-02-18 18:10:04\')')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:04\', \'2026-02-18 18:10:04\')')
 3 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 4 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 5 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 6 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 7 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 8 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:10:04 --> [Caused by] mysqli_sql_exception: Unknown column 'created_at' in 'INSERT INTO'
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:04\', \'2026-02-18 18:10:04\')', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:04\', \'2026-02-18 18:10:04\')')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:04\', \'2026-02-18 18:10:04\')')
 4 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 5 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 6 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 7 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 8 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 9 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
10 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
11 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
12 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
13 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
14 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
15 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:10:04 --> [Caused by] mysqli_sql_exception: Unknown column 'created_at' in 'INSERT INTO'
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:04\', \'2026-02-18 18:10:04\')', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:04\', \'2026-02-18 18:10:04\')')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:04\', \'2026-02-18 18:10:04\')')
 4 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 5 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 6 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 7 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 8 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 9 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
10 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
11 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
12 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
13 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
14 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
15 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 18:10:04 --> mysqli_sql_exception: Unknown column 'created_at' in 'INSERT INTO' in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `co...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `co...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `co...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `co...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(838): CodeIgniter\Model->doInsert(Array)
#6 /var/www/html/tfg/club_lucha_api/system/Model.php(797): CodeIgniter\BaseModel->insert(Array, true)
#7 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(41): CodeIgniter\Model->insert(Array)
#8 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#11 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#13 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#14 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#15 {main}
CRITICAL - 2026-02-18 18:10:04 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'created_at' in 'INSERT INTO'
[Method: POST, Route: api/mensajes]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 2 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 3 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 4 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 5 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 6 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
 7 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
 8 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 9 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
10 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
11 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
12 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:10:04 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'created_at' in 'INSERT INTO'
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:04\', \'2026-02-18 18:10:04\')')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:04\', \'2026-02-18 18:10:04\')')
 3 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 4 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 5 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 6 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 7 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 8 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:10:05 --> [Caused by] mysqli_sql_exception: Unknown column 'created_at' in 'INSERT INTO'
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:04\', \'2026-02-18 18:10:04\')', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:04\', \'2026-02-18 18:10:04\')')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:04\', \'2026-02-18 18:10:04\')')
 4 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 5 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 6 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 7 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 8 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 9 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
10 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
11 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
12 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
13 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
14 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
15 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 18:10:05 --> mysqli_sql_exception: Unknown column 'created_at' in 'INSERT INTO' in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `co...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `co...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `co...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `co...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(838): CodeIgniter\Model->doInsert(Array)
#6 /var/www/html/tfg/club_lucha_api/system/Model.php(797): CodeIgniter\BaseModel->insert(Array, true)
#7 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(41): CodeIgniter\Model->insert(Array)
#8 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#11 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#13 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#14 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#15 {main}
CRITICAL - 2026-02-18 18:10:05 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'created_at' in 'INSERT INTO'
[Method: POST, Route: api/mensajes]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 2 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 3 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 4 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 5 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 6 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
 7 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
 8 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 9 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
10 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
11 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
12 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:10:05 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'created_at' in 'INSERT INTO'
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:05\', \'2026-02-18 18:10:05\')')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:05\', \'2026-02-18 18:10:05\')')
 3 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 4 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 5 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 6 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 7 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 8 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:10:05 --> [Caused by] mysqli_sql_exception: Unknown column 'created_at' in 'INSERT INTO'
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:05\', \'2026-02-18 18:10:05\')', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:05\', \'2026-02-18 18:10:05\')')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:05\', \'2026-02-18 18:10:05\')')
 4 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 5 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 6 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 7 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 8 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 9 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
10 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
11 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
12 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
13 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
14 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
15 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 18:10:05 --> mysqli_sql_exception: Unknown column 'created_at' in 'INSERT INTO' in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `co...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `co...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `co...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `co...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(838): CodeIgniter\Model->doInsert(Array)
#6 /var/www/html/tfg/club_lucha_api/system/Model.php(797): CodeIgniter\BaseModel->insert(Array, true)
#7 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(41): CodeIgniter\Model->insert(Array)
#8 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#11 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#13 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#14 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#15 {main}
CRITICAL - 2026-02-18 18:10:05 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'created_at' in 'INSERT INTO'
[Method: POST, Route: api/mensajes]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 2 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 3 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 4 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 5 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 6 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
 7 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
 8 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 9 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
10 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
11 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
12 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:10:05 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'created_at' in 'INSERT INTO'
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:05\', \'2026-02-18 18:10:05\')')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:05\', \'2026-02-18 18:10:05\')')
 3 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 4 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 5 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 6 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 7 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 8 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:10:05 --> [Caused by] mysqli_sql_exception: Unknown column 'created_at' in 'INSERT INTO'
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:05\', \'2026-02-18 18:10:05\')', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:05\', \'2026-02-18 18:10:05\')')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (\'5\', \'3\', \'2026-02-18 18:10:05\', \'2026-02-18 18:10:05\')')
 4 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `created_at`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :created_at:, :ultimo_mensaje_at:)', [...], false)
 5 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 6 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 7 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 8 APPPATH/Models/ConversacionModel.php(41): CodeIgniter\Model->insert([...])
 9 APPPATH/Controllers/Api/Mensajes.php(64): App\Models\ConversacionModel->crearConversacion('5', '3')
10 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
11 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
12 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
13 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
14 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
15 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 18:36:52 --> mysqli_sql_exception: Cannot add or update a child row: a foreign key constraint fails (`club_lucha_db`.`mensajes`, CONSTRAINT `mensajes_ibfk_2` FOREIGN KEY (`destinatario_id`) REFERENCES `usuarios` (`id`) ON DELETE CASCADE) in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `me...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `me...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `me...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `me...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(838): CodeIgniter\Model->doInsert(Array)
#6 /var/www/html/tfg/club_lucha_api/system/Model.php(797): CodeIgniter\BaseModel->insert(Array, true)
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(89): CodeIgniter\Model->insert(Array)
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create('7')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
ERROR - 2026-02-18 18:36:52 --> mysqli_sql_exception: Cannot add or update a child row: a foreign key constraint fails (`club_lucha_db`.`mensajes`, CONSTRAINT `mensajes_ibfk_2` FOREIGN KEY (`destinatario_id`) REFERENCES `usuarios` (`id`) ON DELETE CASCADE) in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `me...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `me...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `me...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `me...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(838): CodeIgniter\Model->doInsert(Array)
#6 /var/www/html/tfg/club_lucha_api/system/Model.php(797): CodeIgniter\BaseModel->insert(Array, true)
#7 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(89): CodeIgniter\Model->insert(Array)
#8 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create('7')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#11 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#13 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#14 {main}
CRITICAL - 2026-02-18 18:36:52 --> CodeIgniter\Database\Exceptions\DatabaseException: Cannot add or update a child row: a foreign key constraint fails (`club_lucha_db`.`mensajes`, CONSTRAINT `mensajes_ibfk_2` FOREIGN KEY (`destinatario_id`) REFERENCES `usuarios` (`id`) ON DELETE CASCADE)
[Method: POST, Route: api/mensajes/7]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `mensajes` (`remitente_id`, `destinatario_id`, `cuerpo`, `tipo`) VALUES (:remitente_id:, :destinatario_id:, :cuerpo:, :tipo:)', [...], false)
 2 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 3 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 4 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 5 APPPATH/Controllers/Api/Mensajes.php(89): CodeIgniter\Model->insert([...])
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create('7')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:36:52 --> CodeIgniter\Database\Exceptions\DatabaseException: Cannot add or update a child row: a foreign key constraint fails (`club_lucha_db`.`mensajes`, CONSTRAINT `mensajes_ibfk_2` FOREIGN KEY (`destinatario_id`) REFERENCES `usuarios` (`id`) ON DELETE CASCADE)
[Method: POST, Route: api/mensajes/7]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `mensajes` (`remitente_id`, `destinatario_id`, `cuerpo`, `tipo`) VALUES (:remitente_id:, :destinatario_id:, :cuerpo:, :tipo:)', [...], false)
 2 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 3 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 4 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 5 APPPATH/Controllers/Api/Mensajes.php(89): CodeIgniter\Model->insert([...])
 6 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create('7')
 7 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 8 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:36:52 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Cannot add or update a child row: a foreign key constraint fails (`club_lucha_db`.`mensajes`, CONSTRAINT `mensajes_ibfk_2` FOREIGN KEY (`destinatario_id`) REFERENCES `usuarios` (`id`) ON DELETE CASCADE)
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `mensajes` (`remitente_id`, `destinatario_id`, `cuerpo`, `tipo`) VALUES (3, 0, \'jeta\', \'privado\')')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `mensajes` (`remitente_id`, `destinatario_id`, `cuerpo`, `tipo`) VALUES (3, 0, \'jeta\', \'privado\')')
 3 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `mensajes` (`remitente_id`, `destinatario_id`, `cuerpo`, `tipo`) VALUES (:remitente_id:, :destinatario_id:, :cuerpo:, :tipo:)', [...], false)
 4 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 5 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 6 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 7 APPPATH/Controllers/Api/Mensajes.php(89): CodeIgniter\Model->insert([...])
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create('7')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:36:52 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Cannot add or update a child row: a foreign key constraint fails (`club_lucha_db`.`mensajes`, CONSTRAINT `mensajes_ibfk_2` FOREIGN KEY (`destinatario_id`) REFERENCES `usuarios` (`id`) ON DELETE CASCADE)
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `mensajes` (`remitente_id`, `destinatario_id`, `cuerpo`, `tipo`) VALUES (3, 0, \'jeta\', \'privado\')')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `mensajes` (`remitente_id`, `destinatario_id`, `cuerpo`, `tipo`) VALUES (3, 0, \'jeta\', \'privado\')')
 3 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `mensajes` (`remitente_id`, `destinatario_id`, `cuerpo`, `tipo`) VALUES (:remitente_id:, :destinatario_id:, :cuerpo:, :tipo:)', [...], false)
 4 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 5 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 6 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 7 APPPATH/Controllers/Api/Mensajes.php(89): CodeIgniter\Model->insert([...])
 8 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create('7')
 9 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
10 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
11 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
12 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
13 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:36:52 --> [Caused by] mysqli_sql_exception: Cannot add or update a child row: a foreign key constraint fails (`club_lucha_db`.`mensajes`, CONSTRAINT `mensajes_ibfk_2` FOREIGN KEY (`destinatario_id`) REFERENCES `usuarios` (`id`) ON DELETE CASCADE)
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `mensajes` (`remitente_id`, `destinatario_id`, `cuerpo`, `tipo`) VALUES (3, 0, \'jeta\', \'privado\')', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `mensajes` (`remitente_id`, `destinatario_id`, `cuerpo`, `tipo`) VALUES (3, 0, \'jeta\', \'privado\')')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `mensajes` (`remitente_id`, `destinatario_id`, `cuerpo`, `tipo`) VALUES (3, 0, \'jeta\', \'privado\')')
 4 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `mensajes` (`remitente_id`, `destinatario_id`, `cuerpo`, `tipo`) VALUES (:remitente_id:, :destinatario_id:, :cuerpo:, :tipo:)', [...], false)
 5 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 6 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 7 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 8 APPPATH/Controllers/Api/Mensajes.php(89): CodeIgniter\Model->insert([...])
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create('7')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:36:52 --> [Caused by] mysqli_sql_exception: Cannot add or update a child row: a foreign key constraint fails (`club_lucha_db`.`mensajes`, CONSTRAINT `mensajes_ibfk_2` FOREIGN KEY (`destinatario_id`) REFERENCES `usuarios` (`id`) ON DELETE CASCADE)
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `mensajes` (`remitente_id`, `destinatario_id`, `cuerpo`, `tipo`) VALUES (3, 0, \'jeta\', \'privado\')', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `mensajes` (`remitente_id`, `destinatario_id`, `cuerpo`, `tipo`) VALUES (3, 0, \'jeta\', \'privado\')')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `mensajes` (`remitente_id`, `destinatario_id`, `cuerpo`, `tipo`) VALUES (3, 0, \'jeta\', \'privado\')')
 4 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `mensajes` (`remitente_id`, `destinatario_id`, `cuerpo`, `tipo`) VALUES (:remitente_id:, :destinatario_id:, :cuerpo:, :tipo:)', [...], false)
 5 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 6 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 7 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 8 APPPATH/Controllers/Api/Mensajes.php(89): CodeIgniter\Model->insert([...])
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create('7')
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 18:42:42 --> CodeIgniter\Database\Exceptions\DatabaseException: Updates are not allowed unless they contain a "where" or "like" clause.
[Method: POST, Route: api/mensajes/7]
in SYSTEMPATH/Model.php on line 456.
 1 SYSTEMPATH/BaseModel.php(1010): CodeIgniter\Model->doUpdate(null, [...])
 2 SYSTEMPATH/Model.php(860): CodeIgniter\BaseModel->update(null, [...])
 3 APPPATH/Controllers/Api/Mensajes.php(86): CodeIgniter\Model->update(null, [...])
 4 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create('7')
 5 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 6 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 7 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
 8 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 9 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2026-02-18 23:52:09 --> mysqli_sql_exception: Duplicate entry '3-4' for key 'unique_chat' in /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php:327
Stack trace:
#0 /var/www/html/tfg/club_lucha_api/system/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `co...', 0)
#1 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `co...')
#2 /var/www/html/tfg/club_lucha_api/system/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `co...')
#3 /var/www/html/tfg/club_lucha_api/system/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `co...', Array, false)
#4 /var/www/html/tfg/club_lucha_api/system/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
#5 /var/www/html/tfg/club_lucha_api/system/BaseModel.php(838): CodeIgniter\Model->doInsert(Array)
#6 /var/www/html/tfg/club_lucha_api/system/Model.php(797): CodeIgniter\BaseModel->insert(Array, true)
#7 /var/www/html/tfg/club_lucha_api/app/Models/ConversacionModel.php(40): CodeIgniter\Model->insert(Array)
#8 /var/www/html/tfg/club_lucha_api/app/Controllers/Api/Mensajes.php(99): App\Models\ConversacionModel->crearConversacion('3', '4')
#9 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
#10 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
#11 /var/www/html/tfg/club_lucha_api/system/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#12 /var/www/html/tfg/club_lucha_api/system/Boot.php(363): CodeIgniter\CodeIgniter->run()
#13 /var/www/html/tfg/club_lucha_api/system/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#14 /var/www/html/tfg/club_lucha_api/public/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#15 {main}
CRITICAL - 2026-02-18 23:52:09 --> CodeIgniter\Database\Exceptions\DatabaseException: Duplicate entry '3-4' for key 'unique_chat'
[Method: POST, Route: api/mensajes]
in SYSTEMPATH/Database/BaseConnection.php on line 684.
 1 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :ultimo_mensaje_at:)', [...], false)
 2 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 3 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 4 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 5 APPPATH/Models/ConversacionModel.php(40): CodeIgniter\Model->insert([...])
 6 APPPATH/Controllers/Api/Mensajes.php(99): App\Models\ConversacionModel->crearConversacion('3', '4')
 7 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
 8 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
 9 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
10 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
11 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
12 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 23:52:09 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Duplicate entry '3-4' for key 'unique_chat'
in SYSTEMPATH/Database/MySQLi/Connection.php on line 332.
 1 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `ultimo_mensaje_at`) VALUES (\'3\', \'4\', \'2026-02-18 23:52:09\')')
 2 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `ultimo_mensaje_at`) VALUES (\'3\', \'4\', \'2026-02-18 23:52:09\')')
 3 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :ultimo_mensaje_at:)', [...], false)
 4 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 5 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 6 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 7 APPPATH/Models/ConversacionModel.php(40): CodeIgniter\Model->insert([...])
 8 APPPATH/Controllers/Api/Mensajes.php(99): App\Models\ConversacionModel->crearConversacion('3', '4')
 9 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
10 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
11 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
12 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
13 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
14 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2026-02-18 23:52:09 --> [Caused by] mysqli_sql_exception: Duplicate entry '3-4' for key 'unique_chat'
in SYSTEMPATH/Database/MySQLi/Connection.php on line 327.
 1 SYSTEMPATH/Database/MySQLi/Connection.php(327): mysqli->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `ultimo_mensaje_at`) VALUES (\'3\', \'4\', \'2026-02-18 23:52:09\')', 0)
 2 SYSTEMPATH/Database/BaseConnection.php(729): CodeIgniter\Database\MySQLi\Connection->execute('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `ultimo_mensaje_at`) VALUES (\'3\', \'4\', \'2026-02-18 23:52:09\')')
 3 SYSTEMPATH/Database/BaseConnection.php(646): CodeIgniter\Database\BaseConnection->simpleQuery('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `ultimo_mensaje_at`) VALUES (\'3\', \'4\', \'2026-02-18 23:52:09\')')
 4 SYSTEMPATH/Database/BaseBuilder.php(2345): CodeIgniter\Database\BaseConnection->query('INSERT INTO `conversaciones` (`usuario_1_id`, `usuario_2_id`, `ultimo_mensaje_at`) VALUES (:usuario_1_id:, :usuario_2_id:, :ultimo_mensaje_at:)', [...], false)
 5 SYSTEMPATH/Model.php(394): CodeIgniter\Database\BaseBuilder->insert()
 6 SYSTEMPATH/BaseModel.php(838): CodeIgniter\Model->doInsert([...])
 7 SYSTEMPATH/Model.php(797): CodeIgniter\BaseModel->insert([...], true)
 8 APPPATH/Models/ConversacionModel.php(40): CodeIgniter\Model->insert([...])
 9 APPPATH/Controllers/Api/Mensajes.php(99): App\Models\ConversacionModel->crearConversacion('3', '4')
10 SYSTEMPATH/CodeIgniter.php(933): App\Controllers\Api\Mensajes->create()
11 SYSTEMPATH/CodeIgniter.php(507): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\Api\Mensajes))
12 SYSTEMPATH/CodeIgniter.php(354): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
13 SYSTEMPATH/Boot.php(363): CodeIgniter\CodeIgniter->run()
14 SYSTEMPATH/Boot.php(68): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
15 FCPATH/index.php(59): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
